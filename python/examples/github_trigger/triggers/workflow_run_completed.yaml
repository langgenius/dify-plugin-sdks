identity:
  name: workflow_run_completed
  author: langgenius
  label:
    en_US: Workflow Run Completed
    zh_Hans: 工作流运行完成
    pt_BR: Execução de Workflow Concluída

description:
  human:
    en_US: Triggers when a GitHub Actions workflow run is completed
    zh_Hans: 当 GitHub Actions 工作流运行完成时触发
    pt_BR: Dispara quando uma execução de workflow do GitHub Actions é concluída
  llm:
    en_US: This trigger activates when a GitHub Actions workflow run is completed, providing detailed information about the workflow run including status, conclusion, and associated metadata.
    zh_Hans: 当 GitHub Actions 工作流运行完成时，此触发器会被激活，提供有关工作流运行的详细信息，包括状态、结论和相关元数据。
    pt_BR: Este gatilho é ativado quando uma execução de workflow do GitHub Actions é concluída, fornecendo informações detalhadas sobre a execução do workflow incluindo status, conclusão e metadados associados.

parameters:
  - name: workflow_names
    label:
      en_US: Workflow Names Filter
      zh_Hans: 工作流名称过滤
      pt_BR: Filtro de Nomes de Workflow
    type: string
    required: false
    placeholder:
      en_US: "e.g., CI, Deploy*, Release (comma-separated, supports wildcards)"
      zh_Hans: "例如：CI, Deploy*, Release（逗号分隔，支持通配符）"
      pt_BR: "ex: CI, Deploy*, Release (separados por vírgula, suporta wildcards)"
    help:
      en_US: "Only trigger for specific workflow names"
      zh_Hans: "仅对特定工作流名称触发"
      pt_BR: "Disparar apenas para nomes de workflow específicos"

  - name: conclusion_filter
    label:
      en_US: Conclusion Filter
      zh_Hans: 结论过滤
      pt_BR: Filtro de Conclusão
    type: select
    required: false
    options:
      - value: success
        label:
          en_US: Success
          zh_Hans: 成功
          pt_BR: Sucesso
      - value: failure
        label:
          en_US: Failure
          zh_Hans: 失败
          pt_BR: Falha
      - value: cancelled
        label:
          en_US: Cancelled
          zh_Hans: 已取消
          pt_BR: Cancelado
      - value: skipped
        label:
          en_US: Skipped
          zh_Hans: 已跳过
          pt_BR: Ignorado
      - value: timed_out
        label:
          en_US: Timed Out
          zh_Hans: 超时
          pt_BR: Tempo Esgotado
    help:
      en_US: "Only trigger for specific workflow conclusions"
      zh_Hans: "仅对特定工作流结论触发"
      pt_BR: "Disparar apenas para conclusões de workflow específicas"

  - name: branch_filter
    label:
      en_US: Branch Filter
      zh_Hans: 分支过滤
      pt_BR: Filtro de Branch
    type: string
    required: false
    placeholder:
      en_US: "e.g., main, develop, release/* (comma-separated, supports wildcards)"
      zh_Hans: "例如：main, develop, release/*（逗号分隔，支持通配符）"
      pt_BR: "ex: main, develop, release/* (separados por vírgula, suporta wildcards)"
    help:
      en_US: "Only trigger for workflows on these branches"
      zh_Hans: "仅对这些分支上的工作流触发"
      pt_BR: "Disparar apenas para workflows nestas branches"

  - name: duration_threshold
    label:
      en_US: Duration Threshold (seconds)
      zh_Hans: 运行时间阈值（秒）
      pt_BR: Limite de Duração (segundos)
    type: number
    required: false
    placeholder:
      en_US: "e.g., 300 (alert if workflow takes longer than 5 minutes)"
      zh_Hans: "例如：300（如果工作流超过5分钟则警告）"
      pt_BR: "ex: 300 (alertar se o workflow demorar mais de 5 minutos)"
    help:
      en_US: "Only trigger if workflow duration exceeds this threshold"
      zh_Hans: "仅当工作流运行时间超过此阈值时触发"
      pt_BR: "Disparar apenas se a duração do workflow exceder este limite"

output_schema:
  type: object
  properties:
    workflow_run:
      type: object
      properties:
        id:
          type: number
          description: The workflow run ID
        name:
          type: string
          description: The name of the workflow run
        display_title:
          type: string
          description: The display title of the workflow run
        run_number:
          type: number
          description: The run number
        run_attempt:
          type: number
          description: The run attempt number
        status:
          type: string
          description: The status of the workflow run
        conclusion:
          type: string
          description: The conclusion of the workflow run
        workflow_id:
          type: number
          description: The ID of the workflow
        url:
          type: string
          description: The API URL of the workflow run
        html_url:
          type: string
          description: The URL to view the workflow run on GitHub
        created_at:
          type: string
          description: When the workflow run was created
        updated_at:
          type: string
          description: When the workflow run was last updated
        run_started_at:
          type: string
          description: When the workflow run started
        jobs_url:
          type: string
          description: The URL to view jobs for this workflow run
        logs_url:
          type: string
          description: The URL to download logs for this workflow run
        check_suite_url:
          type: string
          description: The URL of the associated check suite
        artifacts_url:
          type: string
          description: The URL to view artifacts for this workflow run
        cancel_url:
          type: string
          description: The URL to cancel this workflow run
        rerun_url:
          type: string
          description: The URL to rerun this workflow run
        head_branch:
          type: string
          description: The head branch name
        head_sha:
          type: string
          description: The head commit SHA
        event:
          type: string
          description: The event that triggered this workflow run
        actor:
          type: object
          properties:
            login:
              type: string
              description: The username of the actor
            avatar_url:
              type: string
              description: The avatar URL of the actor
            html_url:
              type: string
              description: The profile URL of the actor
        triggering_actor:
          type: object
          properties:
            login:
              type: string
              description: The username of the triggering actor
            avatar_url:
              type: string
              description: The avatar URL of the triggering actor
            html_url:
              type: string
              description: The profile URL of the triggering actor
        pull_requests:
          type: array
          description: Pull requests associated with this workflow run
          items:
            type: object
            properties:
              number:
                type: number
                description: Pull request number
              head:
                type: object
                properties:
                  ref:
                    type: string
                    description: Head branch name
                  sha:
                    type: string
                    description: Head commit SHA
              base:
                type: object
                properties:
                  ref:
                    type: string
                    description: Base branch name
                  sha:
                    type: string
                    description: Base commit SHA
    workflow:
      type: object
      properties:
        id:
          type: number
          description: The workflow ID
        name:
          type: string
          description: The workflow name
        path:
          type: string
          description: The path to the workflow file
        state:
          type: string
          description: The state of the workflow
        created_at:
          type: string
          description: When the workflow was created
        updated_at:
          type: string
          description: When the workflow was last updated
        url:
          type: string
          description: The API URL of the workflow
        html_url:
          type: string
          description: The URL to view the workflow on GitHub
        badge_url:
          type: string
          description: The URL of the workflow badge
    repository:
      type: object
      properties:
        name:
          type: string
          description: The repository name
        full_name:
          type: string
          description: The full repository name (owner/repo)
        html_url:
          type: string
          description: The repository URL
        description:
          type: string
          description: The repository description
        private:
          type: boolean
          description: Whether the repository is private
        owner:
          type: object
          properties:
            login:
              type: string
              description: Repository owner username
            avatar_url:
              type: string
              description: Repository owner avatar URL
            html_url:
              type: string
              description: Repository owner profile URL
    sender:
      type: object
      properties:
        login:
          type: string
          description: The username who triggered the event
        avatar_url:
          type: string
          description: The avatar URL of the sender
        html_url:
          type: string
          description: The profile URL of the sender
        type:
          type: string
          description: The type of the sender (User, Bot, etc.)

extra:
  python:
    source: triggers/workflow_run_completed.py