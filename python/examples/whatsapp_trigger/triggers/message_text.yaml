identity:
  name: message_text
  author: dify-community
  label:
    en_US: Text Message Received
    zh_Hans: 收到文本消息
    pt_BR: Mensagem de Texto Recebida

description:
  human:
    en_US: Triggers when a text message is received on WhatsApp
    zh_Hans: 当在 WhatsApp 上收到文本消息时触发
    pt_BR: Dispara quando uma mensagem de texto é recebida no WhatsApp
  llm:
    en_US: This trigger activates when a text message is received on WhatsApp Business, providing the message content, sender information, and conversation context.
    zh_Hans: 当在 WhatsApp Business 上收到文本消息时，此触发器会被激活，提供消息内容、发送者信息和对话上下文。
    pt_BR: Este gatilho é ativado quando uma mensagem de texto é recebida no WhatsApp Business, fornecendo o conteúdo da mensagem, informações do remetente e contexto da conversa.

parameters:
  - name: keyword_filter
    label:
      en_US: Keyword Filter
      zh_Hans: 关键词过滤
      pt_BR: Filtro de Palavras-chave
    type: string
    required: false
    placeholder:
      en_US: "e.g., help, order, support (comma-separated)"
      zh_Hans: "例如：帮助, 订单, 支持（逗号分隔）"
      pt_BR: "ex: ajuda, pedido, suporte (separados por vírgula)"
    help:
      en_US: "Only trigger if message contains any of these keywords (case-insensitive)"
      zh_Hans: "仅当消息包含这些关键词之一时触发（不区分大小写）"
      pt_BR: "Disparar apenas se a mensagem contiver alguma destas palavras-chave"

  - name: language_filter
    label:
      en_US: Language Filter
      zh_Hans: 语言过滤
      pt_BR: Filtro de Idioma
    type: string
    required: false
    placeholder:
      en_US: "e.g., en, zh, pt (comma-separated ISO codes)"
      zh_Hans: "例如：en, zh, pt（逗号分隔的 ISO 代码）"
      pt_BR: "ex: en, zh, pt (códigos ISO separados por vírgula)"
    help:
      en_US: "Only trigger for messages in these languages"
      zh_Hans: "仅对这些语言的消息触发"
      pt_BR: "Disparar apenas para mensagens nestes idiomas"

  - name: sender_filter
    label:
      en_US: Sender Filter
      zh_Hans: 发送者过滤
      pt_BR: Filtro de Remetente
    type: string
    required: false
    placeholder:
      en_US: "e.g., +1234567890, +0987654321 (comma-separated)"
      zh_Hans: "例如：+1234567890, +0987654321（逗号分隔）"
      pt_BR: "ex: +1234567890, +0987654321 (separados por vírgula)"
    help:
      en_US: "Only trigger for messages from these phone numbers"
      zh_Hans: "仅对来自这些电话号码的消息触发"
      pt_BR: "Disparar apenas para mensagens destes números de telefone"

  - name: exclude_senders
    label:
      en_US: Exclude Senders
      zh_Hans: 排除发送者
      pt_BR: Excluir Remetentes
    type: string
    required: false
    placeholder:
      en_US: "Phone numbers to exclude (comma-separated)"
      zh_Hans: "要排除的电话号码（逗号分隔）"
      pt_BR: "Números de telefone para excluir (separados por vírgula)"
    help:
      en_US: "Ignore messages from these phone numbers"
      zh_Hans: "忽略来自这些电话号码的消息"
      pt_BR: "Ignorar mensagens destes números de telefone"

  - name: min_length
    label:
      en_US: Minimum Message Length
      zh_Hans: 最小消息长度
      pt_BR: Comprimento Mínimo da Mensagem
    type: number
    required: false
    placeholder:
      en_US: "e.g., 10"
      zh_Hans: "例如：10"
      pt_BR: "ex: 10"
    help:
      en_US: "Only trigger if message has at least this many characters"
      zh_Hans: "仅当消息至少有这么多字符时触发"
      pt_BR: "Disparar apenas se a mensagem tiver pelo menos este número de caracteres"

  - name: conversation_context
    label:
      en_US: Conversation Context
      zh_Hans: 对话上下文
      pt_BR: Contexto da Conversa
    type: select
    required: false
    options:
      - value: "new"
        label:
          en_US: "New Conversation"
          zh_Hans: "新对话"
          pt_BR: "Nova Conversa"
      - value: "ongoing"
        label:
          en_US: "Ongoing Conversation"
          zh_Hans: "进行中的对话"
          pt_BR: "Conversa em Andamento"
      - value: "all"
        label:
          en_US: "All Conversations"
          zh_Hans: "所有对话"
          pt_BR: "Todas as Conversas"
    default: "all"
    help:
      en_US: "Filter by conversation state"
      zh_Hans: "按对话状态过滤"
      pt_BR: "Filtrar por estado da conversa"

output_schema:
  type: object
  properties:
    message:
      type: object
      properties:
        id:
          type: string
          description: The unique message ID
        type:
          type: string
          description: Message type (always "text" for this trigger)
        text:
          type: object
          properties:
            body:
              type: string
              description: The text content of the message
        timestamp:
          type: string
          description: Message timestamp
        context:
          type: object
          properties:
            from:
              type: string
              description: ID of the message being replied to
            id:
              type: string
              description: Context message ID
            referred_product:
              type: object
              properties:
                catalog_id:
                  type: string
                  description: Product catalog ID
                product_retailer_id:
                  type: string
                  description: Product retailer ID
    sender:
      type: object
      properties:
        wa_id:
          type: string
          description: WhatsApp ID (phone number) of the sender
        name:
          type: string
          description: Profile name of the sender
        profile_picture_url:
          type: string
          description: Profile picture URL of the sender
    business:
      type: object
      properties:
        phone_number_id:
          type: string
          description: WhatsApp Business phone number ID
        display_phone_number:
          type: string
          description: Display phone number of the business
        business_name:
          type: string
          description: Name of the business
    conversation:
      type: object
      properties:
        id:
          type: string
          description: Conversation thread ID
        origin:
          type: object
          properties:
            type:
              type: string
              description: How the conversation started (business_initiated, customer_initiated, referral_conversion)
        expiry_timestamp:
          type: string
          description: When the conversation window expires
    metadata:
      type: object
      properties:
        received_at:
          type: string
          description: When the message was received by the webhook
        language:
          type: string
          description: Detected language of the message
        is_forwarded:
          type: boolean
          description: Whether the message was forwarded
        is_reply:
          type: boolean
          description: Whether this is a reply to another message

extra:
  python:
    source: triggers/message_text.py