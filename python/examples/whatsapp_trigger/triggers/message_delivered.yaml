identity:
  name: message_delivered
  author: dify-community
  label:
    en_US: Message Delivered
    zh_Hans: 消息已送达
    pt_BR: Mensagem Entregue

description:
  human:
    en_US: Triggers when a message is delivered to the recipient
    zh_Hans: 当消息送达收件人时触发
    pt_BR: Dispara quando uma mensagem é entregue ao destinatário
  llm:
    en_US: This trigger activates when a WhatsApp message sent by your business is successfully delivered to the recipient's device.
    zh_Hans: 当您的企业发送的 WhatsApp 消息成功送达收件人设备时，此触发器会被激活。
    pt_BR: Este gatilho é ativado quando uma mensagem do WhatsApp enviada pela sua empresa é entregue com sucesso ao dispositivo do destinatário.

parameters:
  - name: recipient_filter
    label:
      en_US: Recipient Filter
      zh_Hans: 收件人过滤
      pt_BR: Filtro de Destinatário
    type: string
    required: false
    placeholder:
      en_US: "e.g., +1234567890, +0987654321 (comma-separated)"
      zh_Hans: "例如：+1234567890, +0987654321（逗号分隔）"
      pt_BR: "ex: +1234567890, +0987654321 (separados por vírgula)"
    help:
      en_US: "Only trigger for deliveries to these phone numbers"
      zh_Hans: "仅对送达这些电话号码的消息触发"
      pt_BR: "Disparar apenas para entregas a estes números de telefone"

  - name: message_type_filter
    label:
      en_US: Message Type Filter
      zh_Hans: 消息类型过滤
      pt_BR: Filtro de Tipo de Mensagem
    type: select
    required: false
    multiple: true
    options:
      - value: "text"
        label:
          en_US: "Text"
          zh_Hans: "文本"
          pt_BR: "Texto"
      - value: "template"
        label:
          en_US: "Template"
          zh_Hans: "模板"
          pt_BR: "Modelo"
      - value: "interactive"
        label:
          en_US: "Interactive"
          zh_Hans: "交互式"
          pt_BR: "Interativo"
      - value: "media"
        label:
          en_US: "Media"
          zh_Hans: "媒体"
          pt_BR: "Mídia"
    help:
      en_US: "Filter by message type (leave empty for all)"
      zh_Hans: "按消息类型过滤（留空表示所有）"
      pt_BR: "Filtrar por tipo de mensagem (deixe vazio para todos)"

  - name: include_conversation_id
    label:
      en_US: Include Conversation ID
      zh_Hans: 包含对话 ID
      pt_BR: Incluir ID da Conversa
    type: select
    required: false
    options:
      - value: "yes"
        label:
          en_US: "Yes"
          zh_Hans: "是"
          pt_BR: "Sim"
      - value: "no"
        label:
          en_US: "No"
          zh_Hans: "否"
          pt_BR: "Não"
    default: "yes"
    help:
      en_US: "Include conversation thread ID in output"
      zh_Hans: "在输出中包含对话线程 ID"
      pt_BR: "Incluir ID do thread de conversa na saída"

output_schema:
  type: object
  properties:
    status:
      type: object
      properties:
        id:
          type: string
          description: The message ID
        status:
          type: string
          description: Status type (always "delivered" for this trigger)
        timestamp:
          type: string
          description: When the message was delivered
        recipient_id:
          type: string
          description: WhatsApp ID of the recipient
        conversation:
          type: object
          properties:
            id:
              type: string
              description: Conversation thread ID
            origin:
              type: object
              properties:
                type:
                  type: string
                  description: How the conversation started
            expiry_timestamp:
              type: string
              description: When the conversation window expires
        pricing:
          type: object
          properties:
            billable:
              type: boolean
              description: Whether this message is billable
            pricing_model:
              type: string
              description: Pricing model used
            category:
              type: string
              description: Message category for pricing
    business:
      type: object
      properties:
        phone_number_id:
          type: string
          description: WhatsApp Business phone number ID
        display_phone_number:
          type: string
          description: Display phone number of the business
    metadata:
      type: object
      properties:
        delivered_at:
          type: string
          description: Timestamp when the message was delivered
        delivery_attempts:
          type: number
          description: Number of delivery attempts
        message_type:
          type: string
          description: Type of message that was delivered

extra:
  python:
    source: triggers/message_delivered.py