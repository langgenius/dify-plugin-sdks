identity:
  name: gmail_new_email
  author: langgenius
  label:
    en_US: Gmail Message Received
    zh_Hans: 收到 Gmail 邮件
    ja_JP: Gmail メッセージ受信

description:
  en_US: Triggered when Gmail delivers a Pub/Sub notification for new mailbox changes.
  zh_Hans: 当 Gmail 通过 Pub/Sub 推送新的邮箱变更通知时触发。
  ja_JP: Gmail が新しいメールボックスの変更を Pub/Sub 通知した際にトリガーされます。

parameters:
- name: history_types
  type: checkbox
  multiple: true
  required: false
  default:
  - messageAdded
  options:
  - value: messageAdded
    label:
      en_US: Message Added
      zh_Hans: 新增邮件
      ja_JP: メッセージ追加
  - value: messageDeleted
    label:
      en_US: Message Deleted
      zh_Hans: 邮件删除
      ja_JP: メッセージ削除
  - value: labelAdded
    label:
      en_US: Label Added
      zh_Hans: 标签已添加
      ja_JP: ラベル追加
  - value: labelRemoved
    label:
      en_US: Label Removed
      zh_Hans: 标签已移除
      ja_JP: ラベル削除
- name: max_messages
  type: number
  required: false
  default: 20
  label:
    en_US: Max Messages
    zh_Hans: 最大邮件数量
    ja_JP: 最大メッセージ数
  help:
    en_US: Maximum number of messages to fetch per notification.
    zh_Hans: 每次通知最多抓取的邮件数量。
    ja_JP: 通知ごとに取得するメッセージの最大数。
- name: include_message_payload
  type: switch
  required: false
  default: false
  label:
    en_US: Fetch Message Payloads
    zh_Hans: 拉取邮件内容
    ja_JP: メッセージ本文を取得
  help:
    en_US: When enabled, the trigger fetches each message from the Gmail API.
    zh_Hans: 启用后会调用 Gmail API 获取每封邮件的详细内容。
    ja_JP: 有効にすると Gmail API を呼び出して各メッセージの詳細を取得します。
- name: message_format
  type: select
  required: false
  default: metadata
  label:
    en_US: Gmail Message Format
    zh_Hans: Gmail 邮件格式
    ja_JP: Gmail メッセージ形式
  options:
  - value: metadata
    label:
      en_US: Metadata (headers only)
      zh_Hans: 元数据（仅头部）
      ja_JP: メタデータ（ヘッダーのみ）
  - value: minimal
    label:
      en_US: Minimal
      zh_Hans: 精简
      ja_JP: ミニマル
  - value: full
    label:
      en_US: Full
      zh_Hans: 完整
      ja_JP: フル
  - value: raw
    label:
      en_US: Raw (base64)
      zh_Hans: 原始（Base64）
      ja_JP: Raw（Base64）
  help:
    en_US: Gmail API format used when fetching each message payload.
    zh_Hans: 获取邮件内容时使用的 Gmail API 格式。
    ja_JP: メッセージ本文取得時に使用する Gmail API フォーマット。
- name: metadata_headers
  type: text-input
  required: false
  label:
    en_US: Metadata Headers
    zh_Hans: 元数据表头
    ja_JP: メタデータヘッダー
  help:
    en_US: Optional comma-separated list of headers to include when using metadata format.
    zh_Hans: 使用 metadata 格式时需要包含的头部，逗号分隔。
    ja_JP: metadata 形式使用時に含めるヘッダーをカンマ区切りで指定します。

output_schema:
  type: object
  properties:
    email_address:
      type: string
      description: Gmail mailbox that generated the notification.
    history_id:
      type: string
      description: Latest Gmail history ID delivered in this notification.
    start_history_id:
      type: string
      description: History ID used as the starting point for the History API call.
    message_ids:
      type: array
      description: Message identifiers discovered in the Gmail history response.
      items:
        type: string
    messages:
      type: array
      description: Optional message payloads returned from the Gmail API.
      items:
        type: object
        additionalProperties: true
    raw_payload:
      type: object
      description: Raw JSON payload decoded from the Pub/Sub message.
    attributes:
      type: object
      description: Attributes included with the Pub/Sub push message.

extra:
  python:
    source: events/new_email/new_email.py
